#include <IRremote.h>
#include <avr/pgmspace.h>

#define Sensor 7
#define Ar 10
#define Luz 12
#define botao_ligaAr 4

IRsend irsend;

void setup() {

  pinMode(botao_ligaAr, INPUT);
  pinMode(Sensor, INPUT);
  pinMode(Ar, OUTPUT);
  pinMode(Luz, OUTPUT);
  Serial.begin(9600);
}

//---------------------------------------------------------
//FUNÇÃO DE CONTROLE
//---------------------------------------------------------

const int sinal [] PROGMEM = {9000,4450, 600,1650, 600,1600, 650,500, 650,500, 600,550, 600,500, 650,500, 650,1600, 650,500, 600,1600, 650,1600, 650,500, 650,500, 650,450, 600,550, 600,550, 600,550, 600,500, 600,1650, 650,500, 650,500, 600,500, 650,500, 600,550, 550,550, 650,1600, 650,500, 650,500, 600,500, 600,550, 600,550, 600,500, 650,500, 650,500, 600,500, 650,500, 650,500, 600,500, 650,500, 600,550, 650,450, 650,500, 600,550, 550,600, 550,550, 650,500, 650,450, 650,500, 650,7900, 600,500, 650,500, 600,550, 600,500, 650,500, 650,500, 600,500, 650,500, 600,550, 600,500, 650,500, 650,500, 650,450, 650,500, 650,500, 650,450, 650,500, 600,550, 650,450, 650,500, 600,550, 600,550, 600,500, 650,500, 600,550, 600,500, 650,500, 600,550, 600,500, 650,500, 650,500, 600,500, 650,500, 600,550, 600,500, 650,500, 600,550, 600,500, 650,500, 600,550, 600,500, 650,500, 650,500, 600,500, 650,500, 600,550, 600,500, 650,500, 600,550, 600,500, 650,500, 600,550, 600,500, 650,500, 650,500, 600,600, 600,500, 650,1600, 600,1650, 600,550, 600,500, 650,500, 600,550, 600,550, 600};  // NEC C1602040

void EnviaSinal() {
  unsigned int irSinal [230];
  memcpy_P(&irSinal,&sinal, sizeof irSinal);
  
  delay(1000);
  int khz = 38;  
  //unsigned int  irSinal[] = {8950,4500, 550,1700, 550,1650, 600,550, 600,550, 600,550, 550,600, 550,550, 600,1650, 600,550, 550,1700, 550,1700, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,1700, 550,600, 550,550, 600,550, 550,550, 600,550, 600,550, 550,1700, 550,600, 550,550, 600,550, 550,600, 550,550, 600,1650, 600,550, 550,600, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,600, 550,550, 550,600, 550,600, 550,7950, 550,600, 550,550, 600,550, 550,600, 550,600, 550,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 550,550, 600,600, 550,550, 550,600, 550,600, 550,550, 550,600, 550,600, 550,550, 550,600, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 550,600, 550,550, 600,550, 550,550, 600,600, 600,550, 550,1700, 550,1700, 550,600, 550,550, 600,550, 550,600, 550,1700, 550};  // NEC C1602041
  irsend.sendRaw(irSinal, sizeof(irSinal) / sizeof(irSinal[0]), khz);
  //delay(1000);
  //LOG
  Serial.println("Sinal Enviado!!");
  digitalWrite(Ar, LOW);//LED RED
  //

}

//---------------------------------------------------------

//FUNÇÃO DE TESTE
/*
void LigaAr () {

   unsigned int irligar [229];
   memcpy_P(&irligar,&ligar, sizeof irligar);

   delay(1000);
   int khz = 38;
  //unsigned int  irligar[] = {9000,4500, 550,1700, 550,1700, 550,550, 600,550, 600,550, 600,550, 600,500, 600,1650, 600,550, 600,1650, 600,1650, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 600,500, 600,1650, 600,550, 600,550, 550,550, 650,500, 600,550, 600,550, 550,1700, 550,550, 600,550, 600,550, 550,600, 550,550, 600,1650, 600,550, 600,550, 550,550, 600,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,550, 650,500, 600,550, 600,550, 550,550, 600,550, 600,550, 550,8000, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 600,550, 550,600, 550,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,550, 550,550, 600,550, 600,550, 550,600, 550,550, 600,550, 600,600, 600,550, 550,1700, 550,1700, 600,500, 600,550, 600,550, 550,550, 600,1650, 600};  // NEC C1602041
  irsend.sendRaw(irligar, sizeof(irligar) / sizeof(irligar[0]), khz);
  //delay(1000);
  //LOG
  Serial.println("Ar Condicionado ligado");
  digitalWrite(Ar, HIGH); //LED RED
  //
}
*/
boolean flag = false;

void loop() {

  int verSensor = digitalRead(Sensor);
  int verBotao = digitalRead(botao_ligaAr);
 
    if(verSensor == LOW && flag == true){
      Serial.println("IF Sensor - SEM NINGUEM NA SALA");
      EnviaSinal(); // desligar
      digitalWrite(Luz, LOW);//LED GREEN
      flag = false;
    }
    if(verSensor == HIGH && flag == false){
      digitalWrite(Luz, HIGH);//LED GREEN
      Serial.println("ELSE Sensor - COM PESSOAS NA SALA"); 
      flag = true;
    }
  
  if(verBotao == HIGH){
    Serial.println("IF botao - LIGAR O AR CONDICIONADO");
    EnviaSinal();//ligar
    delay(2000);
  }
}



